{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://compgene.example.com/schemas/run.schema.json",
  "title": "CompGene Run Metadata",
  "description": "Schema for .run.json audit files generated by rule executions",
  "type": "object",
  "required": [
    "rule",
    "wildcards",
    "cmd",
    "tool_version",
    "input_checksums",
    "threads",
    "runtime_seconds",
    "exit_code",
    "timestamp"
  ],
  "properties": {
    "rule": {
      "type": "string",
      "description": "The Snakemake rule name",
      "pattern": "^[a-z][a-z0-9_]*$",
      "examples": ["orthofinder", "qc_busco", "standardize_proteins"]
    },
    "wildcards": {
      "type": "object",
      "description": "Dictionary of wildcard values",
      "additionalProperties": {
        "type": "string"
      },
      "examples": [{"species_set": "lemur_macaque"}, {"species": "mmur"}]
    },
    "cmd": {
      "type": "array",
      "description": "Command executed as list of strings",
      "items": {
        "type": "string"
      },
      "minItems": 1,
      "examples": [["orthofinder", "-f", "proteins/", "-t", "8"]]
    },
    "tool_version": {
      "type": "string",
      "description": "Version string of the external tool",
      "examples": ["2.5.5", "5.4.7", "1.6.3"]
    },
    "input_checksums": {
      "type": "object",
      "description": "Checksums of input files/directories",
      "additionalProperties": {
        "type": "string",
        "pattern": "^[a-z0-9]+:[a-f0-9]+$|^[a-z0-9]+:MISSING$"
      },
      "examples": [{"proteins/": "sha256:abc123def456"}]
    },
    "threads": {
      "type": "integer",
      "description": "Number of threads used",
      "minimum": 1,
      "examples": [8, 16, 4]
    },
    "runtime_seconds": {
      "type": "number",
      "description": "Execution time in seconds",
      "minimum": 0,
      "examples": [3600.5, 120.0, 45.23]
    },
    "exit_code": {
      "type": "integer",
      "description": "Process exit code (0 = success)",
      "examples": [0, 1, 137]
    },
    "timestamp": {
      "type": "string",
      "description": "ISO 8601 timestamp of completion (UTC)",
      "format": "date-time",
      "examples": ["2026-01-20T10:15:32+00:00"]
    },
    "output_checksums": {
      "type": "object",
      "description": "Optional checksums of output files/directories",
      "additionalProperties": {
        "type": "string",
        "pattern": "^[a-z0-9]+:[a-f0-9]+$"
      }
    },
    "error_code": {
      "type": "string",
      "description": "Optional ErrorCode value if error occurred",
      "enum": [
        "E_INPUT_MISSING",
        "E_INPUT_FORMAT",
        "E_TOOL_NOT_FOUND",
        "E_TOOL_VERSION",
        "E_TIMEOUT",
        "E_OOM",
        "E_NET_RATE_LIMIT",
        "E_DISK_FULL",
        "E_NONZERO_EXIT"
      ]
    },
    "error_message": {
      "type": "string",
      "description": "Optional error message if error occurred"
    }
  },
  "additionalProperties": false
}
