$schema: "http://json-schema.org/draft-07/schema#"
description: "CompGene configuration schema - validates pipeline configuration"
type: object
required:
  - project
  - species
additionalProperties: false

properties:
  project:
    type: object
    description: "Project metadata and output settings"
    required:
      - name
      - output_dir
    additionalProperties: false
    properties:
      name:
        type: string
        description: "Project name (alphanumeric and underscores, must start with letter)"
        pattern: "^[a-zA-Z][a-zA-Z0-9_]*$"
        minLength: 1
        maxLength: 64
      output_dir:
        type: string
        description: "Output directory path for results"
        minLength: 1

  species:
    type: array
    description: "List of species to analyze"
    items:
      type: object
      required:
        - name
      additionalProperties: false
      properties:
        name:
          type: string
          description: "Species identifier (alphanumeric and underscores)"
          pattern: "^[a-zA-Z][a-zA-Z0-9_]*$"
          minLength: 1
          maxLength: 64
        assembly:
          type: string
          description: "Path to genome assembly FASTA or NCBI accession"
        annotation:
          type: string
          description: "Path to annotation GFF3/GTF or NCBI accession (e.g., NCBI:GCF_000165445.1 or GCF_000165445.1)"

  analysis:
    type: object
    description: "Analysis module settings"
    additionalProperties: false
    properties:
      orthology:
        type: object
        additionalProperties: false
        properties:
          method:
            type: string
            description: "Orthology inference method"
            enum:
              - "orthofinder"
            default: "orthofinder"
      expression:
        type: object
        additionalProperties: false
        properties:
          enabled:
            type: boolean
            description: "Enable RNA-seq expression analysis"
            default: false

  ncbi:
    type: object
    description: "NCBI download configuration"
    additionalProperties: false
    properties:
      api_key:
        type: string
        description: "NCBI API key for higher rate limits (optional, can also use NCBI_API_KEY env var)"
      rate_limit:
        type: number
        description: "Requests per second limit (3.0 without API key, 10.0 with)"
        minimum: 0.1
        maximum: 10.0
        default: 3.0
      cache_dir:
        type: string
        description: "Directory for caching downloaded files"
        default: "results/downloads/ncbi"
      force_download:
        type: boolean
        description: "Force re-download even if cached data exists"
        default: false

  busco:
    type: object
    description: "BUSCO quality control configuration (Story 2.4)"
    required:
      - lineage
    additionalProperties: false
    properties:
      lineage:
        type: string
        description: "BUSCO lineage database (e.g., eukaryota_odb10, primates_odb10, mammalia_odb10)"
        minLength: 1
        examples:
          - "eukaryota_odb10"
          - "primates_odb10"
          - "mammalia_odb10"
      mode:
        type: string
        description: "BUSCO run mode"
        enum:
          - "proteins"
          - "genome"
          - "transcriptome"
        default: "proteins"
      download_path:
        type: string
        description: "Path for lineage database storage/download"
      offline:
        type: boolean
        description: "Offline mode - do not auto-download lineage databases"
        default: false
      timeout:
        type: integer
        description: "Execution timeout in seconds"
        minimum: 60
        maximum: 86400
        default: 1800

  liftoff:
    type: object
    description: "Liftoff annotation lifting configuration (Story 5.1, 5.2, 5.3)"
    additionalProperties: false
    properties:
      comparisons:
        type: array
        description: "List of annotation lifting comparisons"
        items:
          type: object
          required:
            - reference
            - targets
          additionalProperties: false
          properties:
            reference:
              type: string
              description: "Reference species name (must match a species in species list or species_paths)"
              minLength: 1
            targets:
              type: array
              description: "Target species names for annotation lifting"
              items:
                type: string
                minLength: 1
              minItems: 1
      species_paths:
        type: object
        description: "Custom file paths for species (overrides standardized paths)"
        additionalProperties:
          type: object
          properties:
            genome:
              type: string
              description: "Path to genome FASTA (gzipped or uncompressed)"
            annotation:
              type: string
              description: "Path to annotation GFF3 (gzipped or uncompressed)"
      min_coverage:
        type: number
        description: "Minimum sequence coverage threshold (0.0 to 1.0)"
        minimum: 0.0
        maximum: 1.0
        default: 0.5
      min_identity:
        type: number
        description: "Minimum sequence identity threshold (0.0 to 1.0)"
        minimum: 0.0
        maximum: 1.0
        default: 0.5
      include_uncertain:
        type: boolean
        description: "Include uncertain genes in enhanced annotation output (Story 5.3)"
        default: false
      copies:
        type: boolean
        description: "Allow multiple copies of genes to be mapped"
        default: false
      flank:
        type: integer
        description: "Flanking sequence length for alignment"
        minimum: 0
        default: 0
      timeout:
        type: integer
        description: "Execution timeout in seconds"
        minimum: 60
        maximum: 86400
        default: 3600

  resources:
    type: object
    description: "Compute resource limits"
    additionalProperties: false
    properties:
      threads:
        type: integer
        description: "Maximum number of threads to use"
        minimum: 1
        maximum: 128
        default: 8
      memory:
        type: string
        description: "Maximum memory allocation (e.g., 16G, 32G, 64G)"
        pattern: "^[1-9][0-9]*[GMK]$"
        default: "16G"
